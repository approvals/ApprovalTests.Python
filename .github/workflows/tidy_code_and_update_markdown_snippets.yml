name: Tidy Code and Update Markdown Snippets

on:
  push:
    branches: ['main']
  workflow_dispatch:

jobs:
  format_and_snippets:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v6
    - uses: jdx/mise-action@v3
    - run: mise install  # retry for network issues
    - run: mise pip-install || mise pip-install  # retry for network issues
    - run: ./tidy_code.sh
    - run: ./run_mdsnippets.sh
      shell: bash
    # ensure that the above changes didn't break the build
    - run: ./build_and_test.sh
      env:
        MISE_JOBS: 1
      shell: bash
    - name: Git Commit and Push
      uses: github-actions-x/commit@v2.9
      with:
        github-token: "${secrets.GITHUB_TOKEN}"
        commit-message: ". d tidy code and update markdown snippets"
        rebase: 'true'
        push-branch: 'main'
        name: github actions
        email: actions@github.com 

